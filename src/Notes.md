Comparing head, tail indices that may wrap around is pretty subtle. Check spmc and mpmc queues for that.